# UCAS 数据结构大作业 全国交通咨询模拟

### 火车部分

首先将数据导入。

如果一个车站经过 $k$ 个车次，就把这个点拆成 $k$ 个。然后做成 2 层的分层图。总点数是 $O(mp)$ 的，其中 $m$ 是车次数，$p$ 是平均经过的车站数。实际上 $mp \sim 4\times 10^5$ 。

第二层完全复制第一层，且第二层的点不会被加入所属的 Station 中。但会在 Node 的 station_id 里面存储所属 Station 的 ID，目的是为了正确判断 expire。

对于每列车次，提取每小段连有向边（一类边）（只在该车站对应该车次的点加边），边权包括到达时间之差，区间票价（认为票价符合区间两端之差）。

对于每个车站，对每个拆出的点，第一层的每个往第二层每个不同车次的点连有向边（二类边），边权包括间隔时间（2**到达**时间-1**到达**时间，目的是为了接上。比较时需要加上停靠时间补足。），票价为0。

每个点维护该车站该车次的到达时间和出发时间。

询问应输入：出发地/车站，目的地/车站，出发时间（HH:MM，只搜索一天中该时间后出发的），是否接受换乘（0次/1次）及间隔时间

默认不接受换乘，出发时间00:00，换乘间隔时间：同站换乘，>=30min

对于不换乘的，在所有起始车站枚举所有经过的车次，选择出发时间符合条件的，作为源点。建超级源点向每个源点连边，边权由每个起点的（出发时间-到达时间）决定，以平衡停留时间带来的小偏差。所有目的地车站对应车次的点为终点。

对于换乘的，源点同上。终点为所有目的地车站的在两层的所有点。要求经过的二类边的（边权+终点的停留时间）必须不小于规定的换乘间隔时间。

区间票价用 int 保存，为实际票价乘以 100，时间以分钟为单位，用 int 保存。

求最短路和非严格次短路。

输入：出发地/车站，目的地/车站，出发时间（HH:MM，只搜索一天中该时间后出发的），是否接受换乘（0/1）及间隔时间

返回：每段的车次，起点站，终点站，票价和时间段（起点站出发时间-到站时间）。

### 飞机部分

首先将数据导入。
思路与火车类似


### 数据结构
使用小根堆维护。数据类型为 pair，分别为第一关键字和第二关键字。

存图使用链式前向星。


### 增删
通过对每个 `Station` 和 `Train_id` 增加维护一个 `expire` 来实现。

增加车站，先字符串查找是否已经存在。如果存在且 `expire == 1`，则在对应的 `Station` 中将 `expire` 赋为 0，插入成功；如果 `expire == 0` 返回增加失败，信息为已经存在。如果不存在，则要求输入城市名，如果城市名存在则在该城市下创建一个 Station，`expire = 0`，插入成功；如果不存在则创建一个城市，在这个城市下创建一个 Station。

删除车站，先字符串查找是否已经存在。如果不存在或 `expire == 1`，则返回错误，信息为不存在或已被删除；否则在对应的 `Station` 中将 `expire` 赋为 0。

增加火车车次，先字符串查找车次（train_id）是否已经存在。如果存在且 `expire == 1`，则将该车次的 `expire` 赋为 0；如果 `expire == 0` 返回增加失败，信息为已经存在。如果不存在，要求按格式输入：第一行车站数 n，接下来一行 n 个字符串表示车站名，必须都已经存在，接下来 n-1 行每行依次输入，第 i 站到第 i+1 站这段的 出发时间(HH:MM)，到达时间(HH:MM)，票价（两位小数）。

删除火车车次，先字符串查找车次（train_id）是否已经存在。如果存在且 `expire == 0`，则将该车次的 `expire` 赋为 1；否则失败，已经删除。

如果一个 Station 的 expire == 1，那么其在两层图对应的所有点都失效。具体来讲，在 dijkstra() 函数中，从 Station 获取 Node 时，需要满足 expire == 0。另外在访问每个 Node 时，要保证对应的 Train_id 的 expire == 0。


### 数据导入
导入火车数据：通过每个车次的 txt 文件导入，要求符合相应格式
导入飞机数据：通过每个航班的 txt 文件导入，要求符合相应格式


代码耦合度好高。。。文件结构乱的一批，，工程还是太难了

其实不用 dijkstra 的。。。这样建图肯定是一个 DAG，直接 dp 啥都能求出来。傻了TAT